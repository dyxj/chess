version: '3'

vars:
  GO_CMD: go

tasks:
  all:
    desc: "Run all tests"
    cmds:
      - |
        {{.GO_CMD}} test ./...

  coverage:
    desc: "Run all tests with cross package coverage"
    cmds:
      - |
        {{.GO_CMD}} test \
          -coverpkg=./... \
          -count=1 \
          -covermode=atomic \
          -coverprofile=coverage.out \
          ./...
      - "{{.GO_CMD}} tool cover -func=coverage.out"
      - "{{.GO_CMD}} tool cover -html=coverage.out -o coverage.html"